@model IEnumerable<final_project.Models.CartItemModel>;

@{
    ViewData["Title"] = "Shopping cart";
}

@* TODO: make the table responsive *@

<div class="container-fluid">
    <div class="row">
        <div class="col-3"></div>
        <div class="col-6">
            <h2 class="text-center">Shopping cart info</h2>
            <table class="table text-center">
                <thead>
                <tr>
                    <th scope="col">Product name</th>
                    <th scope="col">Product price</th>
                    <th scope="col">Product quantity</th>
                    <th scope="col">Subtotal</th>
                    <th scope="col"></th>
                    <th scope="col"></th>
                </tr>
                </thead>
                <tbody>
                @foreach (var cart in Model)
                {
                    <tr id="item-row_@cart.Product.Id">
                        <td>
                            @Html.DisplayFor(item => cart.Product.Name)
                        </td>
                        <td>
                            @Html.DisplayFor(item => cart.Product.Price)
                        </td>
                        <td>
                            <span id="quantity_@cart.Product.Id">@cart.Quantity</span>
                            @* @Html.DisplayFor(item => cart.Quantity) *@
                        </td>
                        <td>
                            <span id="subTotal_@cart.Product.Id">@cart.SubTotal</span>
                            @* @Html.DisplayFor(item => cart.SubTotal) *@
                        </td>
                        <td>
                            <button onclick="increaseQuantity(@cart.Product.Id)" class="btn btn-primary">+</button>
                            <button onclick="decreaseQuantity(@cart.Product.Id)" class="btn btn-danger">-</button>
                            @* @Html.ActionLink("+", "IncreaseQuantity", "Cart", new { id = cart.Product.Id }, new { @class = "btn btn-primary increase-quantity" }) *@
                            @* @Html.ActionLink("-", "ReduceQuantity", "Cart", new { id = cart.Product.Id }, new { @class = "btn btn-danger" }) *@
                        </td>
                        <td>
                            <button onclick="removeItem(@cart.Product.Id)" class="btn btn-danger">Remove</button>
                            @* @Html.ActionLink("Remove", "RemoveFromCart", "Cart", new { id = cart.Product.Id }, new { @class = "btn btn-danger" }) *@
                        </td>
                    </tr>
                }
                <tr>
                    <td colspan="5" style="text-align: right">
                        <span>Total: <span id="total">@ViewBag.total</span></span>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="col-3"></div>
    </div>
</div>

@section Scripts
{
    <script>
        function increaseQuantity(productId){
            var quantityElement = document.getElementById('quantity_' + productId);
            var quantity = parseInt(quantityElement.innerHTML) + 1;
            quantityElement.innerHTML = quantity;
            
            $.ajax({
                url: '/Cart/IncreaseQuantity/' + productId,
                type: 'POST',
                success: function (data){
                    var subTotalElement = document.getElementById('subTotal_' + productId);
                    var totalElement = document.getElementById('total');
                    subTotalElement.innerHTML = data.subTotal.toFixed(2);
                    totalElement.innerHTML = data.total.toFixed(2);
                },
                error: function (){
                }
            });
        }
        
        function decreaseQuantity(productId){
            var quantityElement = document.getElementById('quantity_' + productId);
            var quantity = parseInt(quantityElement.innerHTML) - 1;
            
            if (quantity > 0){
                quantityElement.innerHTML = quantity;
                
                $.ajax({
                    url: '/Cart/ReduceQuantity/' + productId,
                    type: 'POST',
                    success: function (data){
                        var subTotalElement = document.getElementById('subTotal_' + productId);
                        var totalElement = document.getElementById('total');
                        subTotalElement.innerHTML = data.subTotal.toFixed(2);
                        totalElement.innerHTML = data.total.toFixed(2);
                    },
                    error: function (){
                
                    }
                });
            }
        }
        
        function removeItem(productId){
            var itemElement = document.getElementById('item-row_' + productId);
            itemElement.classList.add("d-none");
            
            $.ajax({
                url: '/Cart/RemoveFromCart/' + productId,
                type: 'POST',
                success: function (data){
                    var totalElement = document.getElementById('total');
                    totalElement.innerHTML = data.total.toFixed(2);
                },
                error(){
                        
                }
            });
        }
    </script>
}